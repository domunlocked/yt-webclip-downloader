<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DomZzz Auto Video Downloader</title>
  <style>
    body { font-family: "Khmer OS Battambang", sans-serif; background: #fff; margin: 0; padding: 0; }
    header { padding: 12px; text-align: center; font-size: 18px; font-weight: bold; color: white; background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); background-size: 400% 400%; animation: rainbow 10s linear infinite; }
    @keyframes rainbow { 0%{background-position:0% 50%} 100%{background-position:100% 50%} }
    .container { padding: 16px; }
    textarea { width: 100%; height: 100px; font-size: 16px; }
    button { font-size: 16px; padding: 10px 20px; margin: 5px; border: none; border-radius: 8px; cursor: pointer; }
    button.mp4 { background: #007bff; color: white; }
    button.mp3 { background: #28a745; color: white; }
    .status { margin-top: 12px; font-size: 14px; }
    .progress-bar { width: 100%; background: #eee; border-radius: 10px; margin: 5px 0; overflow: hidden; }
    .progress { height: 20px; background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); width: 0%; transition: width 0.3s; }
  </style>
</head>
<body>
  <header>DomZzz Auto Video Downloader</header>
  <div class="container">
    <label>បញ្ចូលតំណ (Link) មួយឬច្រើន៖</label><br>
    <textarea id="urls" placeholder="Paste YouTube links here..."></textarea><br>
    <button class="mp4" onclick="startDownload('mp4')">ទាញយកជា MP4</button>
    <button class="mp3" onclick="startDownload('mp3')">ទាញយកជា MP3</button>
    <div id="queue"></div>
  </div>

  <script>
    function startDownload(type) {
      const urls = document.getElementById("urls").value.trim().split("\n");
      if (!urls.length || !urls[0]) {
        alert("សូមបញ្ចូលតំណ (link) ជាមុនសិន!");
        return;
      }
      const queue = document.getElementById("queue");
      queue.innerHTML = "";
      urls.forEach(url => {
        const item = document.createElement("div");
        item.className = "status";
        item.innerHTML = `
          <p>${url}</p>
          <div class="progress-bar"><div class="progress"></div></div>
          <span>⌛ កំពុងរៀបចំ...</span>
        `;
        queue.appendChild(item);

        const bar = item.querySelector(".progress");
        const status = item.querySelector("span");

        fetch("/download", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url, type })
        }).then(r => r.json()).then(data => {
          bar.style.width = "100%";
          status.innerText = "✅ Done: " + data.file;
        }).catch(err => {
          status.innerText = "❌ កំហុស: " + err;
        });
      });
    }
  </script>
</body>
</html>
