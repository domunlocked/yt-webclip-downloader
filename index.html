<!DOCTYPE html>
<html lang="km">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DomZzz Auto Video Downloader</title>

  <!-- iOS WebClip settings (use PNG only) -->
  <link rel="apple-touch-icon" href="/static/icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="YT Downloader">

  <style>
    body { 
      font-family: "Khmer OS Battambang", sans-serif; 
      background: #fff; margin: 0; padding: 0; 
    }

    /* Sticky rainbow header */
    header { 
      position: sticky; top: 0; 
      display: flex; align-items: center; justify-content: flex-start; 
      padding: 8px 12px; 
      background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); 
      background-size: 400% 400%; 
      animation: rainbow 10s linear infinite; 
      color: white; font-weight: bold; font-size: 18px; 
      z-index: 1000;
      position: relative;
    }
    @keyframes rainbow { 
      0%{background-position:0% 50%} 
      100%{background-position:100% 50%} 
    }

    header img { border-radius: 8px; }

    /* Telegram top-right */
    .telegram {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
    }
    .telegram img {
      height: 50px;
      transition: transform 0.2s;
    }
    .telegram img:hover { transform: scale(1.2); }

    /* Title + clock + donate */
    .title-box { display: flex; flex-direction: column; }
    .clock { font-size: 22px; font-weight: bold; margin-top: 4px; }
    .donate { font-size: 14px; margin-top: 6px; display: flex; align-items: center; gap: 8px; }
    .donate img { height: 45px; border-radius: 6px; }

    .container { padding: 16px; }
    textarea { width: 100%; height: 100px; font-size: 16px; border-radius: 8px; padding: 8px; }
    button { 
      font-size: 16px; padding: 12px 20px; margin: 5px 0; 
      border: none; border-radius: 8px; cursor: pointer; width: 100%; 
    }
    button.mp4 { background: #007bff; color: white; }
    button.mp3 { background: #28a745; color: white; }
    .status { margin-top: 12px; font-size: 14px; word-wrap: break-word; }
    .progress-bar { width: 100%; background: #eee; border-radius: 10px; margin: 5px 0; overflow: hidden; }
    .progress { height: 20px; background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet); width: 0%; transition: width 0.3s; }

    /* Responsive tweaks for iPhone */
    @media (max-width: 600px) {
      header { flex-direction: column; align-items: flex-start; font-size: 16px; }
      header div { margin-bottom: 8px; }
      header img { height: 40px; }
      .telegram img { height: 40px; }
      .clock { font-size: 18px; }
      .donate img { height: 35px; }
      button { font-size: 15px; }
      textarea { font-size: 14px; }
    }
  </style>
</head>
<body>
  <!-- Sticky header with logo + Telegram -->
  <header>
    <div style="display:flex; align-items:center;">
      <img src="/static/logo.jpg" alt="App Logo" style="height:50px; margin-right:10px;">
      <div class="title-box">
        <span>DomZzz Auto Video Downloader</span>
        <span class="clock" id="clock">--:--:-- --</span>
        <div class="donate">
          <a href="https://link.payway.com.kh/ABAPAYSr361197l" target="_blank" style="color:white; text-decoration:underline;">Donate Me</a>
          <a href="https://link.payway.com.kh/ABAPAYSr361197l" target="_blank">
            <img src="/static/donate.png" alt="Donate QR">
          </a>
        </div>
      </div>
    </div>
    <div class="telegram">
      <a href="https://t.me/domunlocked" target="_blank">
        <img src="/static/telegram.png" alt="Telegram">
      </a>
    </div>
  </header>

  <div class="container">
    <label>បញ្ចូលតំណ (Link) មួយឬច្រើន៖</label><br>
    <textarea id="urls" placeholder="Paste YouTube links here..."></textarea><br>
    <button class="mp4" onclick="startDownload('mp4')">ទាញយកជា MP4</button>
    <button class="mp3" onclick="startDownload('mp3')">ទាញយកជា MP3</button>
    <div id="queue"></div>
  </div>

  <script>
    // Digital Clock in Phnom Penh Time (GMT+7)
    function updateClock() {
      const clockEl = document.getElementById("clock");
      const now = new Date();
      const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
      const phnomPenh = new Date(utc + (7 * 60 * 60000));

      let hours = phnomPenh.getHours();
      const minutes = phnomPenh.getMinutes().toString().padStart(2, "0");
      const seconds = phnomPenh.getSeconds().toString().padStart(2, "0");
      const ampm = hours >= 12 ? "PM" : "AM";
      hours = hours % 12;
      hours = hours ? hours : 12;

      clockEl.innerText = `${hours}:${minutes}:${seconds} ${ampm}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Downloader
    function startDownload(type) {
      const urls = document.getElementById("urls").value.trim().split("\n");
      if (!urls.length || !urls[0]) {
        alert("សូមបញ្ចូលតំណ (link) ជាមុនសិន!");
        return;
      }
      const queue = document.getElementById("queue");
      queue.innerHTML = "";
      urls.forEach(url => {
        const item = document.createElement("div");
        item.className = "status";
        item.innerHTML = `
          <p>${url}</p>
          <div class="progress-bar"><div class="progress"></div></div>
          <span>⌛ កំពុងរៀបចំ...</span>
        `;
        queue.appendChild(item);

        const bar = item.querySelector(".progress");
        const status = item.querySelector("span");

        fetch("/download", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url, type })
        }).then(r => r.json()).then(data => {
          bar.style.width = "100%";
          status.innerText = "✅ Done: " + data.file;
        }).catch(err => {
          status.innerText = "❌ កំហុស: " + err;
        });
      });
    }
  </script>
</body>
</html>
